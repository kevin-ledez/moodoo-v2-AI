{% extends 'admin/base.html.twig' %}

{% block admin_content %}
<div class="flex justify-between items-center mb-6">
  <h1 class="text-2xl font-bold">Commentaires</h1>
</div>

<div class="overflow-x-auto">
  <table class="table table-zebra">
    <thead>
      <tr>
        <th>Article</th>
        <th>Auteur</th>
        <th>Contenu</th>
        <th>Statut</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for comment in comments %}
        <tr>
          <td>
            <div class="font-medium">{{ comment.post.title|slice(0, 30) }}{% if comment.post.title|length > 30 %}...{% endif %}</div>
          </td>
          <td>
            <div class="font-medium">{{ comment.authorName }}</div>
            <div class="text-sm">{{ comment.authorEmail }}</div>
          </td>
          <td>{{ comment.content|slice(0, 100) }}{% if comment.content|length > 100 %}...{% endif %}</td>
          <td>
            {% if comment.status == 'approved' %}
              <span class="badge badge-success">Approuvé</span>
            {% elseif comment.status == 'pending' %}
              <span class="badge badge-warning">En attente</span>
            {% else %}
              <span class="badge badge-error">Spam</span>
            {% endif %}
          </td>
          <td>{{ comment.createdAt|date('d/m/Y H:i') }}</td>
          <td>
            <div class="flex flex-wrap gap-2">
              {% if comment.status != 'approved' %}
                <form method="post" action="{{ path('admin_comment_approve', {'id': comment.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir approuver ce commentaire ?');">
                  <input type="hidden" name="_token" value="{{ csrf_token('approve' ~ comment.id) }}">
                  <button type="submit" class="btn btn-xs btn-success">
                    <i class="fas fa-check"></i>
                    Approuver
                  </button>
                </form>
              {% endif %}
              
              {% if comment.status != 'spam' %}
                <form method="post" action="{{ path('admin_comment_spam', {'id': comment.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir marquer ce commentaire comme spam ?');">
                  <input type="hidden" name="_token" value="{{ csrf_token('spam' ~ comment.id) }}">
                  <button type="submit" class="btn btn-xs btn-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    Spam
                  </button>
                </form>
              {% endif %}
              
              <form method="post" action="{{ path('admin_comment_delete', {'id': comment.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce commentaire ?');">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ comment.id) }}">
                <button type="submit" class="btn btn-xs btn-error">
                  <i class="fas fa-trash"></i>
                  Supprimer
                </button>
              </form>
            </div>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="6" class="text-center">Aucun commentaire trouvé</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}